<head>
	<link rel="preload" href="./../../../wp-content/themes/supersimple/fonts/SpaceGrotesk-Bold.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="./../../../wp-content/themes/supersimple/fonts/SpaceGrotesk-Light.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="./../../../wp-content/themes/supersimple/fonts/SpaceGrotesk-Regular.woff2" as="font" type="font/woff2" crossorigin>

	<link rel="stylesheet" href="./../../../wp-content/themes/supersimple/style.css">

	<title>Ota Updates &#8211; Rohan Menon</title>
<meta name="robots" content="max-image-preview:large">
<link rel="dns-prefetch" href="//s.w.org">
<link rel="alternate" type="application/rss+xml" title="Rohan Menon &raquo; ota updates Comments Feed" href="./feed/index.html">
<link rel="stylesheet" id="wp-block-library-css" href="./../../../wp-includes/css/dist/block-library/style.min.css?ver=5.7.2" type="text/css" media="all">
<script type="text/javascript" src="./../../../wp-content/themes/supersimple/scripts/gutenberg-filters.js?ver=5.7.2" id="gutenberg-filters-js"></script>
<link rel="https://api.w.org/" href="./../../../wp-json/index.html">
<link rel="alternate" type="application/json" href="./../../../wp-json/wp/v2/posts/224/index.html">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="./../../../xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="./../../../wp-includes/wlwmanifest.xml"> 
<meta name="generator" content="WordPress 5.7.2">
<link rel="canonical" href="./index.html">
<link rel="shortlink" href="./../../../index.html?p=224">
<link rel="alternate" type="application/json+oembed" href="./../../../wp-json/oembed/1.0/embed/index.html?url=https%3A%2F%2F%2Flog-book%2Faquametric%2Fota-updates-and-editable-measurement-frequency%2F">
<link rel="alternate" type="text/xml+oembed" href="./../../../wp-json/oembed/1.0/embed/index.html?url=https%3A%2F%2F%2Flog-book%2Faquametric%2Fota-updates-and-editable-measurement-frequency%2F&#038;format=xml">
<link rel="icon" href="./../../../wp-content/uploads/2021/05/cropped-favicon-32x32.png" sizes="32x32">
<link rel="icon" href="./../../../wp-content/uploads/2021/05/cropped-favicon-192x192.png" sizes="192x192">
<link rel="apple-touch-icon" href="./../../../wp-content/uploads/2021/05/cropped-favicon-180x180.png">
<meta name="msapplication-TileImage" content="./wp-content/uploads/2021/05/cropped-favicon-270x270.png">
		<style type="text/css" id="wp-custom-css">a {
	text-underline-offset: 0.08em;
	text-decoration-thickness: 0.09rem !important;
}</style>
			<meta name="viewport" content="width=100%, initial-scale=1">
</head>

<body class="post-template-default single single-post postid-224 single-format-standard">
		<div class="content">
		
<header id="masthead" class="site-header has-title-and-tagline has-menu" role="banner">
    
<nav>
    <div class="primary-menu-container"><ul id="primary-menu-list" class="menu-wrapper">
<li id="menu-item-34" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home menu-item-34"><a href="./../../../index.html">home</a></li>
<li id="menu-item-589" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-589"><a href="./../../../research/index.html">research</a></li>
<li id="menu-item-282" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-282"><a href="./../../../projects/index.html">projects</a></li>
<li id="menu-item-522" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-522"><a href="./../../index.html">log book</a></li>
</ul></div></nav><!-- #site-navigation -->
</header><!-- #masthead -->
		<main id="main" class="site-main" role="main">
        <div id="post-224">
            
<div id="path">
    <h1 id="pathString">/</h1>
    <div id="haze"></div>
</div>
<h1 id="title">ota updates</h1>
<script>
    var path = (window.location.pathname).split("/");
    var elem = document.getElementById("pathString")
    var haze = document.getElementById("haze")
    var sliced = path.slice(0, path.length - 2).join("/")
    var string = sliced.split("-").join(" ")
    elem.innerHTML = string + "/"
    elem.addEventListener("mouseover", function(event) {
        // haze.style.background = "linear-gradient(90deg, white 10%, rgba(255, 255, 255, 0.4) 100%)"
        haze.style.filter = "opacity(0.5)"
    });
    elem.addEventListener("mouseleave", function(event) {
        // haze.style.background = ""
        haze.style.filter = ""
    });
    elem.addEventListener("click", function(event) {
        window.location.href = sliced + "/"
    });
</script>            <div class="post-tags">
                                    <span class="status">April 24, 2020</span>
                    <span class="status"><a href="./../../../research/aquametric/index.html">aquametric</a></span>
                            </div>
            <div class="detail">
                
<figure class="wp-block-image size-large"><img width="768" height="1024" src="./../../../wp-content/uploads/2021/03/IMG_20200913_181531-1-768x1024.jpg" alt="" class="wp-image-259" srcset="./../../../wp-content/uploads/2021/03/IMG_20200913_181531-1-768x1024.jpg 768w, ./../../../wp-content/uploads/2021/03/IMG_20200913_181531-1-225x300.jpg 225w, ./../../../wp-content/uploads/2021/03/IMG_20200913_181531-1-1152x1536.jpg 1152w, ./../../../wp-content/uploads/2021/03/IMG_20200913_181531-1-1536x2048.jpg 1536w, ./../../../wp-content/uploads/2021/03/IMG_20200913_181531-1-scaled.jpg 1920w" sizes="(max-width: 768px) 100vw, 768px"></figure>



<p>The frequent trips to the stream for software updates were starting to get tiring, so we sought to implement OTA updates. We also wanted to be able to change the frequency at which our sensor wakes up and takes a measurement (e.g. hourly, every 15 minutes).</p>



<p>The Particle Electron microcontroller we are using supports OTA updates out of the box, but it does not save flash requests in any kind of queue. This means that we can&#8217;t update the device firmware for the time that the sensor is in a deep sleep. Additionally, even if we could time the update exactly for when it wakes, the runtime has been minimized to about 15 seconds and so it would not have enough time to complete the update before going back into a deep sleep.</p>



<p>We created a server that handles both the OTA and variable frequency features of the sensor. When the device wakes, it accesses a json file on our server. This contains two pieces of information, the amount time that the device should deep sleep for and whether or not there is an OTA update available.</p>



<p>If there is a piece of firmware ready to upload, the device publishes &#8220;ready_for_update&#8221; to Particle. and waits for 2 minutes. Using webhooks, our OTA server sees this message from the device. It uses Particle JS API to flash the device with the firmware in its queue.</p>



<p>While this seems pretty convoluted, this solution allows the device to skip the 2 minute waiting time if there is no update available which saves battery life. We hope to use the variable measurement frequency to take readings more often when we detect some anomaly with stream conditions.</p>
            </div>
        </div>

</main><!-- #main -->
</div>
<!-- #page -->
<div class="footer">

    
    <div class="footer-image"></div>
    <div class="footer-content">
        2021 Rohan Menon
        <right>
            <a href="#">
                Back to top
            </a>
            ^
        </right>
    </div>
</div>
<div class="cursor"></div>
<div class="dot"></div>
<noscript>
    <style>img {
            opacity: 1 !important;
        }</style>
</noscript>
<script>
    Promise.all(Array.from(document.querySelectorAll('.batch-load')).filter(img => !img.complete).map(img => new Promise(resolve => {
        img.onload = img.onerror = resolve;
    }))).then(() => {
        setImageOpacity(1)
    });

    setTimeout(function() {
        setImageOpacity(1)
    }, 2500);

    function setImageOpacity(opacity) {
        document.querySelectorAll('.batch-load').forEach(function(image) {
            image.style.opacity = opacity;
        });
    }
</script>
<!-- Matomo --><script>var _paq = window._paq = window._paq || [];
_paq.push(['disableCookies']);_paq.push(['trackPageView']);_paq.push(['enableLinkTracking']);_paq.push(['alwaysUseSendBeacon']);_paq.push(['setTrackerUrl', "\/\/www.rohanmenon.com\/wp-content\/plugins\/matomo\/app\/matomo.php"]);_paq.push(['setSiteId', '1']);var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
g.type='text/javascript'; g.async=true; g.src="\/\/www.rohanmenon.com\/wp-content\/uploads\/matomo\/matomo.js"; s.parentNode.insertBefore(g,s);</script><!-- End Matomo Code --><script type="text/javascript" src="./../../../wp-includes/js/wp-embed.min.js?ver=5.7.2" id="wp-embed-js"></script>
</body>