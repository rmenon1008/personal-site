<head>
	<link rel="preload" href="./../../../wp-content/themes/supersimple/fonts/SpaceGrotesk-Bold.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="./../../../wp-content/themes/supersimple/fonts/SpaceGrotesk-Light.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="./../../../wp-content/themes/supersimple/fonts/SpaceGrotesk-Regular.woff2" as="font" type="font/woff2" crossorigin>

	<link rel="stylesheet" href="./../../../wp-content/themes/supersimple/style.css">

	<title>Sensor Initial Versions &#8211; Rohan Menon</title>
<meta name="robots" content="max-image-preview:large">
<link rel="dns-prefetch" href="//s.w.org">
<link rel="alternate" type="application/rss+xml" title="Rohan Menon &raquo; sensor initial versions Comments Feed" href="./feed/index.html">
<link rel="stylesheet" id="wp-block-library-css" href="./../../../wp-includes/css/dist/block-library/style.min.css?ver=5.7.2" type="text/css" media="all">
<script type="text/javascript" src="./../../../wp-content/themes/supersimple/scripts/gutenberg-filters.js?ver=5.7.2" id="gutenberg-filters-js"></script>
<link rel="https://api.w.org/" href="./../../../wp-json/index.html">
<link rel="alternate" type="application/json" href="./../../../wp-json/wp/v2/posts/197/index.html">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="./../../../xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="./../../../wp-includes/wlwmanifest.xml"> 
<meta name="generator" content="WordPress 5.7.2">
<link rel="canonical" href="./index.html">
<link rel="shortlink" href="./../../../index.html?p=197">
<link rel="alternate" type="application/json+oembed" href="./../../../wp-json/oembed/1.0/embed/index.html?url=https%3A%2F%2F%2Flog-book%2Faquametric%2Fsensor-initial-versions%2F">
<link rel="alternate" type="text/xml+oembed" href="./../../../wp-json/oembed/1.0/embed/index.html?url=https%3A%2F%2F%2Flog-book%2Faquametric%2Fsensor-initial-versions%2F&#038;format=xml">
<link rel="icon" href="./../../../wp-content/uploads/2021/05/cropped-favicon-32x32.png" sizes="32x32">
<link rel="icon" href="./../../../wp-content/uploads/2021/05/cropped-favicon-192x192.png" sizes="192x192">
<link rel="apple-touch-icon" href="./../../../wp-content/uploads/2021/05/cropped-favicon-180x180.png">
<meta name="msapplication-TileImage" content="./wp-content/uploads/2021/05/cropped-favicon-270x270.png">
		<style type="text/css" id="wp-custom-css">a {
	text-underline-offset: 0.08em;
	text-decoration-thickness: 0.09rem !important;
}</style>
			<meta name="viewport" content="width=100%, initial-scale=1">
</head>

<body class="post-template-default single single-post postid-197 single-format-standard">
		<div class="content">
		
<header id="masthead" class="site-header has-title-and-tagline has-menu" role="banner">
    
<nav>
    <div class="primary-menu-container"><ul id="primary-menu-list" class="menu-wrapper">
<li id="menu-item-34" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home menu-item-34"><a href="./../../../index.html">home</a></li>
<li id="menu-item-589" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-589"><a href="./../../../research/index.html">research</a></li>
<li id="menu-item-282" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-282"><a href="./../../../projects/index.html">projects</a></li>
<li id="menu-item-522" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-522"><a href="./../../index.html">log book</a></li>
</ul></div></nav><!-- #site-navigation -->
</header><!-- #masthead -->
		<main id="main" class="site-main" role="main">
        <div id="post-197">
            
<div id="path">
    <h1 id="pathString">/</h1>
    <div id="haze"></div>
</div>
<h1 id="title">sensor initial versions</h1>
<script>
    var path = (window.location.pathname).split("/");
    var elem = document.getElementById("pathString")
    var haze = document.getElementById("haze")
    var sliced = path.slice(0, path.length - 2).join("/")
    var string = sliced.split("-").join(" ")
    elem.innerHTML = string + "/"
    elem.addEventListener("mouseover", function(event) {
        // haze.style.background = "linear-gradient(90deg, white 10%, rgba(255, 255, 255, 0.4) 100%)"
        haze.style.filter = "opacity(0.5)"
    });
    elem.addEventListener("mouseleave", function(event) {
        // haze.style.background = ""
        haze.style.filter = ""
    });
    elem.addEventListener("click", function(event) {
        window.location.href = sliced + "/"
    });
</script>            <div class="post-tags">
                                    <span class="status">April 11, 2020</span>
                    <span class="status"><a href="./../../../research/aquametric/index.html">aquametric</a></span>
                            </div>
            <div class="detail">
                
<figure class="wp-block-image size-large"><img width="1024" height="703" src="./../../../wp-content/uploads/2021/03/image-1024x703.png" alt="" class="wp-image-199" srcset="./../../../wp-content/uploads/2021/03/image-1024x703.png 1024w, ./../../../wp-content/uploads/2021/03/image-300x206.png 300w, ./../../../wp-content/uploads/2021/03/image-768x528.png 768w, ./../../../wp-content/uploads/2021/03/image-1536x1055.png 1536w, ./../../../wp-content/uploads/2021/03/image.png 1600w" sizes="(max-width: 1024px) 100vw, 1024px"></figure>



<h3>Version 1</h3>



<p>For the first version of our sensor, we focused on developing a device that could take accurate measurements of the water’s stage height. We initially chose an ultrasonic range finder for this purpose. It was oriented towards the water’s surface. By subtracting the measured value from the height at which the sensor was mounted, we could calculate the height of water flowing through the stream.&nbsp;</p>



<p>We decided to power this device with a solar panel and lithium polymer battery. This would theoretically allow the device to be deployed indefinitely. For communication, a WiFi-based Particle Photon microcontroller was used. WiFi limits the possible locations of the device&#8217;s deployment, but we were less focused with this issue with this iteration. We were more focused on developing a device that could stay powered while providing accurate measurements.</p>



<figure class="wp-block-image size-large"><img width="768" height="1024" src="./../../../wp-content/uploads/2021/03/image-768x1024.jpeg" alt="" class="wp-image-207" title="Design iteration 1" srcset="./../../../wp-content/uploads/2021/03/image-768x1024.jpeg 768w, ./../../../wp-content/uploads/2021/03/image-225x300.jpeg 225w, ./../../../wp-content/uploads/2021/03/image-1152x1536.jpeg 1152w, ./../../../wp-content/uploads/2021/03/image.jpeg 1200w" sizes="(max-width: 768px) 100vw, 768px"></figure>



<p>While this iteration showed promise, it had issues revolving around waterproofing, battery life and connectivity.&nbsp;</p>



<p>While ultrasonic seemed like the clear choice for the sensor, it made the device almost impossible to waterproof. Unfortunately, the ultrasonic sounds from the HC-SR04 can not permeate almost any waterproof materials. This means that the receiving and transmitting elements were directly exposed to weather. They developed rust and failed within a week.</p>



<p>Both the battery and microcontroller operated on 3.3 volts. The ultrasonic sensor required 5 volts to function properly, so a voltage boost circuit had to be added. This added complexity and reduced battery life.</p>



<p>The WiFi based microcontroller that was used prevented the device from being deployed anywhere without an access point and permission to use it. This was the main barrier that we sought to overcome in our next iteration.&nbsp;</p>



<h3>Version 2</h3>



<p>The second design iteration was driven by some of the issues we discovered in preliminary testing of the first version.</p>



<p>This version began with a choice in communication method. LoRa (Long Range) is a communication protocol for low bandwidth and low power communication. There is a large community of developers using LoRa for sensors similar to ours. Some were achieving distances of upwards of 20 miles from transmitter to base station. We determined that most streams of interest would be within 20 miles of a WiFi and power source where a base station could be installed.</p>



<p>After beginning to test the possible range of the sensor, we quickly started realizing that it was going to pose an issue. Simply getting one mile to the nearest stream was impossible. We knew that tree cover was going to reduce the signal strength, but we were not expecting the loss of signal that we observed. Our signal strength was also significantly decreased by the fact that rivers tend to be located in valleys, which meant that our sensor would not have a direct line of sight to the base station. To attempt to fix these issues we first switched from standard linear antennas to two directional antennas.</p>



<figure class="wp-block-image size-large"><img width="768" height="1024" src="./../../../wp-content/uploads/2021/03/image-1-768x1024.png" alt="" class="wp-image-208" title="A directional Yagi antenna mounted in the highest place we could get it: the attic" srcset="./../../../wp-content/uploads/2021/03/image-1-768x1024.png 768w, ./../../../wp-content/uploads/2021/03/image-1-225x300.png 225w, ./../../../wp-content/uploads/2021/03/image-1-1152x1536.png 1152w, ./../../../wp-content/uploads/2021/03/image-1.png 1200w" sizes="(max-width: 768px) 100vw, 768px"></figure>



<p><em>A directional Yagi antenna mounted in the highest place we could get it: the attic.</em></p>



<p>This improvement in range allowed us to develop a sensor for a neighborhood stream about .2 miles from the base station.</p>



<figure class="wp-block-image size-large"><img width="1024" height="768" src="./../../../wp-content/uploads/2021/03/image-2-1024x768.png" alt="" class="wp-image-209" title="This sensor was deployed in a neighborhood stream and used 815 MHz LoRa for communication." srcset="./../../../wp-content/uploads/2021/03/image-2-1024x768.png 1024w, ./../../../wp-content/uploads/2021/03/image-2-300x225.png 300w, ./../../../wp-content/uploads/2021/03/image-2-768x576.png 768w, ./../../../wp-content/uploads/2021/03/image-2.png 1343w" sizes="(max-width: 1024px) 100vw, 1024px"></figure>



<p>Although the use of directional antennas did result in an increase in usable range, this increase was not significant enough to make this a practical solution. We briefly considered creating a system of several repeater stations to re-broadcast signals until the data arrived at our base station, but we decided that a simpler solution would be to move to a communication protocol for which a significant infrastructure of “repeater nodes” already exists &#8211; cellular.</p>



<h3>Version 3</h3>



<p>For the third version of the sensor, we again desired to improve on some of the issues that we discovered with our second design iteration.</p>



<p>Firstly, we switched from LoRa to cellular as the method we would use to transmit data from the sensor. Cellular was initially dismissed as a possible communication method due to its relatively high power consumption. We knew that there would be new challenges to using cellular connectivity, but its benefits would outweigh the costs. By using cellular, we were longer limited by our distance to the sensor &#8211; as long as we were within the range of a cell tower, we would (theoretically) be able to transmit stream data.</p>



<p>Another change that was made in the third design iteration was to switch to AA batteries instead of LiPo (Lithium Polymer) battery cells for our power source. Although alkaline batteries are less energy dense than lithium based batteries, switching came with a variety of advantages. AA batteries are less dangerous, as they don’t have a tendency to ignite when over-discharged. They also have a much longer shelf life, and are less susceptible to extreme temperature and water damage. We found that they performed at temperatures near freezing, which was an important consideration for us.</p>



<p>To reduce power consumption in this version, we added a secondary microcontroller to control power to the main cellular microcontroller. While on the surface, this may seem like simply doubling the required power, it proved highly effective to extend the battery life of the device. The power switching microcontroller is outfitted with a real time clock (RTC). It allows it to enter a very deep sleep state in between sensor readings. Each hour, the RTC wakes up the power switching microcontroller which subsequently uses a MOSFET to provide power to the cellular Particle Boron. This reduced the on-time of the device from 60/60 minutes to about 7/60 minutes.</p>



<p>For the first installation of our final sensor version, we used a 1.5 m aluminum extrusion that was driven about 50 cm into the ground. Finding a location in the riverbed that was soft enough to drive in the extrusion but firm enough to support the sensor was difficult, but we settled on a location under a bridge. Unfortunately, when we came to check on this sensor after a few days, we found the pole had been bent significantly from what we imagine were large ice sheets being carried down by the water. Additionally, a large amount of debris collected on the sensor pole which obstructed our ToF distance sensor.</p>



<figure class="wp-block-image size-large"><img width="755" height="1007" src="./../../../wp-content/uploads/2021/03/image-3.png" alt="" class="wp-image-210" srcset="./../../../wp-content/uploads/2021/03/image-3.png 755w, ./../../../wp-content/uploads/2021/03/image-3-225x300.png 225w" sizes="(max-width: 755px) 100vw, 755px"></figure>



<p></p>



<p>The next deployment of our third iteration drove the development of new mounting systems. We located an alternative spot to mount the sensor, somewhat downstream from our first location, in shallower and faster-moving water. The streambed here was much rockier than our original location, making it nearly impossible to get the metal pole deep enough to provide the necessary stability. To solve this issue, a system was developed in which the aluminum extrusion was fastened to a steel plate through the use of L-brackets. This was placed onto the streambed, and covered with rocks for stability. This new system gave us much greater versatility in the selection of deployment locations. The faster-moving and shallower water made it much more difficult for debris to build up after the sensor, and after a few days there was essentially no debris built up on the sensor at all. Additionally, by moving to a location in the stream somewhat away from the bridge, the strength of the sensor’s cellular connection was also improved.</p>



<figure class="wp-block-image size-large"><img width="483" height="644" src="./../../../wp-content/uploads/2021/03/image-1.jpeg" alt="" class="wp-image-211" title="New mounting solution" srcset="./../../../wp-content/uploads/2021/03/image-1.jpeg 483w, ./../../../wp-content/uploads/2021/03/image-1-225x300.jpeg 225w" sizes="(max-width: 483px) 100vw, 483px"></figure>
            </div>
        </div>

</main><!-- #main -->
</div>
<!-- #page -->
<div class="footer">

    
    <div class="footer-image"></div>
    <div class="footer-content">
        2021 Rohan Menon
        <right>
            <a href="#">
                Back to top
            </a>
            ^
        </right>
    </div>
</div>
<div class="cursor"></div>
<div class="dot"></div>
<noscript>
    <style>img {
            opacity: 1 !important;
        }</style>
</noscript>
<script>
    Promise.all(Array.from(document.querySelectorAll('.batch-load')).filter(img => !img.complete).map(img => new Promise(resolve => {
        img.onload = img.onerror = resolve;
    }))).then(() => {
        setImageOpacity(1)
    });

    setTimeout(function() {
        setImageOpacity(1)
    }, 2500);

    function setImageOpacity(opacity) {
        document.querySelectorAll('.batch-load').forEach(function(image) {
            image.style.opacity = opacity;
        });
    }
</script>
<!-- Matomo --><script>var _paq = window._paq = window._paq || [];
_paq.push(['disableCookies']);_paq.push(['trackPageView']);_paq.push(['enableLinkTracking']);_paq.push(['alwaysUseSendBeacon']);_paq.push(['setTrackerUrl', "\/\/www.rohanmenon.com\/wp-content\/plugins\/matomo\/app\/matomo.php"]);_paq.push(['setSiteId', '1']);var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
g.type='text/javascript'; g.async=true; g.src="\/\/www.rohanmenon.com\/wp-content\/uploads\/matomo\/matomo.js"; s.parentNode.insertBefore(g,s);</script><!-- End Matomo Code --><script type="text/javascript" src="./../../../wp-includes/js/wp-embed.min.js?ver=5.7.2" id="wp-embed-js"></script>
</body>