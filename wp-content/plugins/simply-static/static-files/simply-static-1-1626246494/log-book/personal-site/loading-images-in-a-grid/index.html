<head>
	<link rel="preload" href="./../../../wp-content/themes/supersimple/fonts/SpaceGrotesk-Bold.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="./../../../wp-content/themes/supersimple/fonts/SpaceGrotesk-Light.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="./../../../wp-content/themes/supersimple/fonts/SpaceGrotesk-Regular.woff2" as="font" type="font/woff2" crossorigin>

	<link rel="stylesheet" href="./../../../wp-content/themes/supersimple/style.css">

	<title>Loading Images in a Grid &#8211; Rohan Menon</title>
<meta name="robots" content="max-image-preview:large">
<link rel="dns-prefetch" href="//s.w.org">
<link rel="alternate" type="application/rss+xml" title="Rohan Menon &raquo; loading images in a grid Comments Feed" href="./feed/index.html">
<link rel="stylesheet" id="wp-block-library-css" href="./../../../wp-includes/css/dist/block-library/style.min.css?ver=5.7.2" type="text/css" media="all">
<link rel="stylesheet" id="mkaz-code-syntax-css-css" href="./../../../wp-content/plugins/code-syntax-block/assets/blocks.style.css?ver=1622401314" type="text/css" media="all">
<link rel="stylesheet" id="mkaz-code-syntax-prism-css-css" href="./../../../wp-content/plugins/code-syntax-block/assets/prism-a11y-dark.css?ver=1622401314" type="text/css" media="all">
<script type="text/javascript" src="./../../../wp-content/themes/supersimple/scripts/gutenberg-filters.js?ver=5.7.2" id="gutenberg-filters-js"></script>
<link rel="https://api.w.org/" href="./../../../wp-json/index.html">
<link rel="alternate" type="application/json" href="./../../../wp-json/wp/v2/posts/870/index.html">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="./../../../xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="./../../../wp-includes/wlwmanifest.xml"> 
<meta name="generator" content="WordPress 5.7.2">
<link rel="canonical" href="./index.html">
<link rel="shortlink" href="./../../../index.html?p=870">
<link rel="alternate" type="application/json+oembed" href="./../../../wp-json/oembed/1.0/embed/index.html?url=https%3A%2F%2F%2Flog-book%2Fpersonal-site%2Floading-images-in-a-grid%2F">
<link rel="alternate" type="text/xml+oembed" href="./../../../wp-json/oembed/1.0/embed/index.html?url=https%3A%2F%2F%2Flog-book%2Fpersonal-site%2Floading-images-in-a-grid%2F&#038;format=xml">
<link rel="icon" href="./../../../wp-content/uploads/2021/05/cropped-favicon-32x32.png" sizes="32x32">
<link rel="icon" href="./../../../wp-content/uploads/2021/05/cropped-favicon-192x192.png" sizes="192x192">
<link rel="apple-touch-icon" href="./../../../wp-content/uploads/2021/05/cropped-favicon-180x180.png">
<meta name="msapplication-TileImage" content="./wp-content/uploads/2021/05/cropped-favicon-270x270.png">
		<style type="text/css" id="wp-custom-css">a {
	text-underline-offset: 0.08em;
	text-decoration-thickness: 0.09rem !important;
}</style>
			<meta name="viewport" content="width=100%, initial-scale=1">
</head>

<body class="post-template-default single single-post postid-870 single-format-standard">
		<div class="content">
		
<header id="masthead" class="site-header has-title-and-tagline has-menu" role="banner">
    
<nav>
    <div class="primary-menu-container"><ul id="primary-menu-list" class="menu-wrapper">
<li id="menu-item-34" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home menu-item-34"><a href="./../../../index.html">home</a></li>
<li id="menu-item-589" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-589"><a href="./../../../research/index.html">research</a></li>
<li id="menu-item-282" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-282"><a href="./../../../projects/index.html">projects</a></li>
<li id="menu-item-522" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-522"><a href="./../../index.html">log book</a></li>
</ul></div></nav><!-- #site-navigation -->
</header><!-- #masthead -->
		<main id="main" class="site-main" role="main">
        <div id="post-870">
            
<div id="path">
    <h1 id="pathString">/</h1>
    <div id="haze"></div>
</div>
<h1 id="title">loading images in a grid</h1>
<script>
    var path = (window.location.pathname).split("/");
    var elem = document.getElementById("pathString")
    var haze = document.getElementById("haze")
    var sliced = path.slice(0, path.length - 2).join("/")
    var string = sliced.split("-").join(" ")
    elem.innerHTML = string + "/"
    elem.addEventListener("mouseover", function(event) {
        // haze.style.background = "linear-gradient(90deg, white 10%, rgba(255, 255, 255, 0.4) 100%)"
        haze.style.filter = "opacity(0.5)"
    });
    elem.addEventListener("mouseleave", function(event) {
        // haze.style.background = ""
        haze.style.filter = ""
    });
    elem.addEventListener("click", function(event) {
        window.location.href = sliced + "/"
    });
</script>            <div class="post-tags">
                                    <span class="status">May 30, 2021</span>
                    <span class="status"><a href="./../../../projects/personal-site/index.html">personal site</a></span>
                            </div>
            <div class="detail">
                
<p>High quality images can take a few seconds to load, even on fast internet connections, but users expect websites to be interactive in much under that. Browsers typically handle this by loading in the text and layout information first, while loading the images in the background. When an image is ready for display, it appears on the page.</p>



<p>While this works great for most scenarios, this random popping into view can be jarring when there are many images in view at once, such as in a grid layout. When load times are slow, the problem is only made worse.</p>



<figure class="wp-block-video"><video autoplay loop muted src="./../../../wp-content/uploads/2021/05/ezgif.com-gif-maker-1.webm" playsinline></video><figcaption>Loading before optimization (throttled connection)</figcaption></figure>



<h3>My Implementation</h3>



<p>The solution is to load in placeholder boxes immediately, both to signify the presence of content and to avoid a layout shift when the images load. Then, once all the images have finished loading, fade them in over the placeholders with a quick animation. This ends up being much more pleasing, even on slower connections.</p>



<figure class="wp-block-video"><video autoplay loop muted src="./../../../wp-content/uploads/2021/05/ezgif.com-gif-maker-3-1.webm"></video><figcaption>After optimization (same throttling speed)</figcaption></figure>



<p>Here&#8217;s the CSS</p>



<pre class="wp-block-code"><code lang="css" class="language-css">.batch-load {
   opacity: 0; /* Images start completely transparent */
   transition: 0.4s; /* When they load in, they are animated slightly */
}

.image-container {
   background-color: #ebebeb; /* Image containers are given a light gray background */
}</code></pre>



<p>And the JS</p>



<pre class="wp-block-code"><code lang="javascript" class="language-javascript">// Stolen from https://stackoverflow.com/questions/11071314/
// Triggers when all the batch-loaded images have finished loading
Promise.all(Array.from(document.querySelectorAll('.batch-load')).filter(img =&gt; !img.complete).map(img =&gt; new Promise(resolve =&gt; {
     img.onload = img.onerror = resolve;
}))).then(() =&gt; {
     setImageOpacity(1)
});

// If it's taken 2.5s and the images haven't finished, just show whatever we have
setTimeout(function() {
     setImageOpacity(1)
}, 2500);

function setImageOpacity(opacity) {
     document.querySelectorAll('.batch-load').forEach(function(image) {
         image.style.opacity = opacity;
     });
}</code></pre>



<p>This method involves setting the image transparent on the initial load. If the browser doesnâ€™t support JS execution, we want to make sure that the images are visible, so this bit gets added to the site footer just in case.</p>



<pre class="wp-block-code"><code lang="markup" class="language-markup">&lt;noscript&gt;
    &lt;style&gt;
        img {
            opacity: 1 <strong>!important</strong>;
        }
    &lt;/style&gt;
&lt;/noscript&gt;</code></pre>
            </div>
        </div>

</main><!-- #main -->
</div>
<!-- #page -->
<div class="footer">

    
    <div class="footer-image"></div>
    <div class="footer-content">
        2021 Rohan Menon
        <right>
            <a href="#">
                Back to top
            </a>
            ^
        </right>
    </div>
</div>
<div class="cursor"></div>
<div class="dot"></div>
<noscript>
    <style>img {
            opacity: 1 !important;
        }</style>
</noscript>
<script>
    Promise.all(Array.from(document.querySelectorAll('.batch-load')).filter(img => !img.complete).map(img => new Promise(resolve => {
        img.onload = img.onerror = resolve;
    }))).then(() => {
        setImageOpacity(1)
    });

    setTimeout(function() {
        setImageOpacity(1)
    }, 2500);

    function setImageOpacity(opacity) {
        document.querySelectorAll('.batch-load').forEach(function(image) {
            image.style.opacity = opacity;
        });
    }
</script>
<!-- Matomo --><script>var _paq = window._paq = window._paq || [];
_paq.push(['disableCookies']);_paq.push(['trackPageView']);_paq.push(['enableLinkTracking']);_paq.push(['alwaysUseSendBeacon']);_paq.push(['setTrackerUrl', "\/\/www.rohanmenon.com\/wp-content\/plugins\/matomo\/app\/matomo.php"]);_paq.push(['setSiteId', '1']);var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
g.type='text/javascript'; g.async=true; g.src="\/\/www.rohanmenon.com\/wp-content\/uploads\/matomo\/matomo.js"; s.parentNode.insertBefore(g,s);</script><!-- End Matomo Code --><script type="text/javascript" id="mkaz-code-syntax-prism-js-js-extra">
/* <![CDATA[ */
var prism_settings = {"pluginUrl":".\/wp-content\/plugins\/code-syntax-block\/"};
/* ]]> */
</script>
<script type="text/javascript" src="./../../../wp-content/plugins/code-syntax-block/assets/prism/prism.js?ver=1622401314" id="mkaz-code-syntax-prism-js-js"></script>
<script type="text/javascript" src="./../../../wp-includes/js/wp-embed.min.js?ver=5.7.2" id="wp-embed-js"></script>
</body>